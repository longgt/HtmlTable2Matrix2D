/**
 * @license MIT License
 *
 * Copyright (c) 2023 longgt
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 **/
!function(){let t={};t.mtTable=function(){function r2aPosition(t,e,l){let r=e,o=-1,i=l[0].length;for(let n=0;n<i;n++)if(l[t][n]>0&&o++,o==e){r=n;break}return r}function a2rPosition(t,e,l){let r=0;for(let o=0;o<e;o++)l[t][o]<0&&r++;return e-r}function detectMergeCell(t,e,l,r){let o=[];if("left"==l){if(e>0){let l=e-1,i=t;for(;l>=0&&-2==r[i][l];)l--;for(;i>=0&&-1==r[i][l];)i--;o.push(i),o.push(l)}}else if("right"==l){if(e+1<r[0].length){let l=e+1,i=t;for(;i>=0&&-1==r[i][l];)i--;o.push(i),o.push(l)}}else if("up"==l){if(t>0){let l=e,i=t-1;for(;l>=0&&-2==r[i][l];)l--;for(;i>=0&&-1==r[i][l];)i--;o.push(i),o.push(l)}}else if("down"==l&&t+1<r.length){let l=e,i=t+1;for(;l>=0&&-2==r[i][l];)l--;o.push(i),o.push(l)}return o.length>0&&o[1]>=0?o[1]=a2rPosition(o[0],o[1],r):o=[],o}function add(t,e){if(!e||0==e.length||e[0]<0||e[1]<0)return;let l=!1,r=t.length;for(let o=0;o<r;o++)if(v=t[o],v[0]==e[0]&&v[1]==e[1])return l=!0,!1;l||t.push(e)}function prevCell(t,e,l){let r=[];if(r.push(t),e>=0){let o=e;for(;o>=0&&l[t][o]<0;)o--;r.push(o>=0?a2rPosition(t,o,l):o)}else r.push(-1);return r}return{reset:function(){this.mt=[],this.debug=!1},load:function(t,e,l){void 0===Array.fill&&(Array.prototype.fill=function(t){let e=this.length;for(let l=0;l<e;l++)this[l]=t;return this});let r="object"==typeof t?t:document.querySelector(t),o=[],i=e?e.split(","):[];r.querySelectorAll("tr").forEach((t=>{let e=[];t.querySelectorAll("th,td").forEach((t=>{if(i.length>0)for(let e=0,l=i.length;e<l;e++)if(t.classList.contains(i[e]))return;let l=[];l.push(~~t.getAttribute("rowspan")||1),l.push(~~t.getAttribute("colspan")||1),e.push(l)})),o.push(e)}));let n=[],h=o.length,f=0;for(let t=0,e=o.length>0?o[0].length:0;t<e;t++)f+=o[0][t][1];for(let t=0;t<h;t++){let e=new Array(f).fill(t+1);n.push(e)}for(let t=0;t<h;t++){let e=o[t],l=0,r=e.length;for(let o=0;o<r;o++){let r=e[o];for(;n[t][l]<0;)l++;let i=r[0],h=r[1];for(let e=1;e<h;e++)n[t][l+e]=-2;for(let e=1;e<i;e++){n[t+e][l]=-1;for(let r=1;r<h;r++)n[t+e][l+r]=-2}l+=h}}this.mt=n,this.debug=l},getRelCell:function(t,e,l){let r=[],o=r2aPosition(t,e,this.mt),i=1,n=1,h=this.mt;for(;o+n<h[t].length&&-2==h[t][o+n];)n++;for(;t+i<h.length&&-1==h[t+i][o];)i++;for(let e=0;e<i;e++)for(let f=0;f<n;f++){if(0==f&&"left"==l){add(r,detectMergeCell(t+e,o,"left",h))}if(f==n-1&&"right"==l){add(r,detectMergeCell(t+e,o+f,"right",h))}if(0==e&&"up"==l){add(r,detectMergeCell(t,o+f,"up",h))}if(e==i-1&&"down"==l){add(r,detectMergeCell(t+e,o+f,"down",h))}}return r},getMultiRelCell:function(t,e){let l=[];if(t)for(let r=0,o=t.length;r<o;r++){let o=t[r],i=this.getRelCell(o[0],o[1],e);if(i.length>0)for(let t=0,e=i.length;t<e;t++)add(l,i[t])}return l},getHtmlStructure:function(){let t=[],e=this.mt;rowCnt=e.length;for(let l=0;l<rowCnt;l++){let r=[];colCnt=e[l].length;for(let t=0;t<colCnt;)if(e[l][t]>=0){let o=1,i=1;for(;t+o<colCnt&&-2==e[l][t+o];)o++;for(;l+i<rowCnt&&-1==e[l+i][t];)i++;let n=[];n.push(i),n.push(o),r.push(n),t+=o}else t++;r.length>0&&t.push(r)}if(this.debug)for(let t=0;t<e.length;t++){let l=[];for(let r=0;r<e[t].length;r++)l.push(e[t][r]>=0?" "+e[t][r]:e[t][r]);console.log(l.join(","))}return t},deleteColAt:function(t,e,l){let r=r2aPosition(t,e,this.mt),o=this.mt,i=o.length,n=[];if(1==l)for(;r+1<o[t].length&&-2==o[t][r+1];)r++;for(let t=0;t<i;t++)if(o[t][r]<0){let e=t,l=r;for(;l>=0&&-2==o[e][l];)l--;for(;e>=0&&-1==o[e][l];)e--;let i=[];i.push(e),i.push(l>=0?a2rPosition(e,l,this.mt):l),add(n,i)}else{let e=[];e.push(t),e.push(a2rPosition(t,r,this.mt)),add(n,e)}return n},deleteRowAt:function(t){let e=this.mt,l=(e.length,[]);if(t>=0&&t<e.length)for(let r=0;r<e[t].length;r++)if(e[t][r]<0){let o=t,i=r;for(;i>=0&&-2==e[o][i];)i--;for(;o>=0&&-1==e[o][i];)o--;let n=[];n.push(o),n.push(i>=0?a2rPosition(o,i,this.mt):i),add(l,n)}else{let e=[];e.push(t),e.push(a2rPosition(t,r,this.mt)),add(l,e)}return l},insertableCellNextRow:function(t,e){let l=r2aPosition(t,e,this.mt),r=[];return l>=0&&t<this.mt.length-1&&(r=prevCell(t+1,l,this.mt)),r},insertableCell:function(t,e){return prevCell(t,r2aPosition(t,e,this.mt),this.mt)},beforeCell:function(t,e,l){let r=r2aPosition(t,e,this.mt),o=this.mt,i=[];for(let e=0;e<l;e++){let l=r-1,n=t+e;for(;l>=0&&o[n][l]<0;)l--;let h=[];h.push(n),h.push(l>=0?a2rPosition(n,l,this.mt):l),i.push(h)}return i},absoluteCol:function(t,e){return r2aPosition(t,e,this.mt)},getRowSize:function(t){let e=0;return t>=0&&t<this.mt.length&&(e=this.mt[t].length),e},hasCell:function(t,e){let l=r2aPosition(t,e,this.mt),r=!1;return t>=0&&t<this.mt.length&&l>=0&&l<this.mt[t].length&&(r=this.mt[t][l]>0),r},getMatrix:function(){return this.mt},extendSize:function(t,e,l,r){let o=r2aPosition(t,e,this.mt),i=this.mt,n={},h=0,f=[],s=[],u=1,g=1;for(let e=o+1;e<i[t].length&&-2==i[t][e];e++)g++;for(let e=t+1;e<i.length&&-1==i[e][o];e++)u++;if(l>u||r>g){let e,n,s={row:t,col:o},c=1;if(r>g){for(let l=o+1;l<i[t].length&&-1!=i[t][l];l++)if(c++,c==r){e={row:t,col:l};break}c!=r&&0==h&&(h=-1)}else e={row:t,col:o+r-1};if(c=1,l>u){for(let e=t+1;e<i.length&&-2!=i[e][o];e++)if(c++,c==l){n={row:e,col:o};break}c!=l&&0==h&&(h=-2)}else n={row:t+l-1,col:o};let a={row:t+u-1,col:o+g-1};if(n.row+1<i.length){let t=n.row+1;for(let l=n.col;l<=e.col;l++)if((t>a.row||l>a.col)&&-1==i[t][l]){h=-1;break}}let p=e.col+1;for(let t=e.row;t<=n.row;t++)if((t>a.row||p>a.col)&&p<i[t].length&&-2==i[t][p]){h=-2;break}n.row,e.col;for(let t=s.row;t<=n.row;t++)for(let l=s.col;l<=e.col;l++)if(i[t][l]>0){let e=[];e.push(t),e.push(a2rPosition(t,l,this.mt)),add(f,e)}}if(l<u||r<g)for(let e=0;e<u;e++){let n,h=0;e<l?(h=g-r,h>0&&(n=prevCell(t+e,o,i))):(h=g,n=prevCell(t+e,o,i)),h>0&&s.push({row:t+e,start:n,howMany:h})}return n.errorCode=h,n.mergeCells=f,n.splitCells=s,n}}}(),window.Table2Matrix=t}();